/*
 * Test: Combined use of T? and T!E
 * Shows the distinction: T? for "maybe", T!E for errors
 */
#include <ccc/std/prelude.cch>

/* Returns an optional - absence is normal, not an error */
int? find_positive(int x) {
    if (x > 0) {
        return cc_some_CCOptional_int(x);
    }
    return cc_none_CCOptional_int();
}

/* Returns a result - failure is an error condition */
int!CCError require_positive(int x) {
    if (x > 0) {
        return cc_ok(x);
    }
    return cc_err(cc_error(CC_ERR_INVALID_ARG, "must be positive"));
}

/* Pattern: Optional input, Result output */
int!CCError process_if_found(int x) {
    int? maybe = find_positive(x);
    if (!maybe.has) {
        return cc_err(cc_error(CC_ERR_NOT_FOUND, "no positive value"));
    }
    return cc_ok(*maybe * 2);
}

int main(void) {
    /* Test T? with positive */
    int? p1 = find_positive(5);
    if (!p1.has) { printf("FAIL: expected some\n"); return 1; }
    printf("find_positive(5) = %d\n", *p1);
    
    /* Test T? with non-positive */
    int? p2 = find_positive(-3);
    if (p2.has) { printf("FAIL: expected none\n"); return 1; }
    printf("find_positive(-3) = none (expected)\n");
    
    /* Test T!E with positive */
    int!CCError r1 = require_positive(5);
    if (!r1.ok) { printf("FAIL: expected ok\n"); return 1; }
    printf("require_positive(5) = %d\n", r1.u.value);
    
    /* Test T!E with non-positive */
    int!CCError r2 = require_positive(-3);
    if (r2.ok) { printf("FAIL: expected error\n"); return 1; }
    printf("require_positive(-3) = error: %s\n", r2.u.error.message);
    
    /* Test combined pattern */
    int!CCError c1 = process_if_found(10);
    if (!c1.ok) { printf("FAIL: expected ok\n"); return 1; }
    printf("process_if_found(10) = %d\n", c1.u.value);
    
    int!CCError c2 = process_if_found(-5);
    if (c2.ok) { printf("FAIL: expected error\n"); return 1; }
    printf("process_if_found(-5) = error: %s\n", c2.u.error.message);
    
    printf("\nAll combined optional/result tests passed!\n");
    return 0;
}
