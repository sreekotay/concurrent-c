/* Test: mixed value and reference capture [x, &y], including function parameters */
#include <ccc/cc_nursery.cch>
#include <stdio.h>

/* Test capturing function parameters (not just local variables) */
void test_param_capture(int level, const char* name) {
    @nursery {
        /* Capture function parameters directly */
        spawn([level, name]() => {
            printf("param capture: level=%d, name=%s\n", level, name);
        });
    }
}

int main(void) {
    int x = 10;
    int y = 20;
    
    @nursery {
        /* x by value (copied), y by reference (shared, read-only) */
        spawn([x, &y]() => {
            printf("value x=%d, ref y=%d\n", x, y);
        });
    }
    
    /* Test function parameter capture */
    test_param_capture(42, "hello");
    
    return (x == 10 && y == 20) ? 0 : 1;
}
