// Test: Result type syntax T!E lowers to CCResult_T_E
#include <stdio.h>
#include <ccc/cc_runtime.cch>

// CCResult_int_CCError is pre-declared in cc_result.cch via CC_DECL_RESULT_SPEC

int!CCError make_ok(void) {
    return cc_ok(42);
}

int!CCError make_err(void) {
    return cc_err(CC_ERR_NOT_FOUND, "not found");
}

int main(void) {
    // Declare a result using T!E syntax
    int!CCError r;
    
    // Initialize to ok - inferred from return type
    r = make_ok();
    if (!r.ok) {
        printf("FAIL: r should be ok\n");
        return 1;
    }
    if (r.u.value != 42) {
        printf("FAIL: r.u.value should be 42, got %d\n", r.u.value);
        return 1;
    }
    
    // Initialize to error - shorthand error form
    r = make_err();
    if (r.ok) {
        printf("FAIL: r should be error\n");
        return 1;
    }
    if (r.u.error.kind != CC_ERR_NOT_FOUND) {
        printf("FAIL: r.u.error.kind should be CC_ERR_NOT_FOUND\n");
        return 1;
    }
    
    printf("OK: result type syntax works\n");
    return 0;
}
