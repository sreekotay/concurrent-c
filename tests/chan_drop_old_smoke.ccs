#include "std/prelude.cch"
#include <assert.h>

int main(void) {
    int[~1 >, DropOld] tx;
    int[~1 <, DropOld] rx;
    channel_pair(&tx, &rx);

    // Fill then overwrite
    assert(chan_send(tx, 1) == 0);
    assert(chan_send(tx, 2) == 0);

    int v = 0;
    assert(chan_recv(rx, &v) == 0);
    assert(v == 2);

    chan_close(tx);
    chan_free(rx);
    return 0;
}
