/* Test: cc_block_all runs tasks concurrently.
   Expected: Both tasks complete, results are correct. */
#include <ccc/cc_runtime.cch>
#include <stdio.h>

@async int add(int a, int b) {
    return a + b;
}

@async int mul(int a, int b) {
    return a * b;
}

int main(void) {
    /* Create tasks (lazy, not started yet) */
    CCTaskIntptr tasks[] = {
        add(2, 3),
        mul(4, 5)
    };

    /* Run all concurrently, block until all complete */
    intptr_t results[2];
    int err = cc_block_all(2, tasks, results);

    printf("err=%d, add=%d, mul=%d\n", err, (int)results[0], (int)results[1]);

    if (err != 0) return 1;
    if (results[0] != 5) return 2;   /* 2 + 3 = 5 */
    if (results[1] != 20) return 3;  /* 4 * 5 = 20 */

    printf("Result: PASS\n");
    return 0;
}
