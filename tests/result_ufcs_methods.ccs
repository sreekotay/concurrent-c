// Test: Result UFCS methods (.unwrap(), .is_ok(), .is_err(), .unwrap_or())
#include <stdio.h>

int !> (CCError) succeed(int v) {
    return cc_ok(v);
}

int !> (CCError) fail_it(void) {
    return cc_err(CC_ERR_NOT_FOUND, "not found");
}

int main(void) {
    // Test is_ok() and is_err()
    int !> (CCError) r1 = succeed(42);
    int !> (CCError) r2 = fail_it();
    
    if (r1.is_ok()) {
        printf("r1 is ok: %d\n", r1.u.value);
    }
    if (r1.is_err()) {
        printf("ERROR: r1 should not be err\n");
        return 1;
    }
    
    if (r2.is_err()) {
        printf("r2 is err: %s\n", r2.u.error.message);
    }
    if (r2.is_ok()) {
        printf("ERROR: r2 should not be ok\n");
        return 1;
    }
    
    // Test unwrap() on success
    int !> (CCError) r3 = succeed(100);
    int v = r3.unwrap();
    printf("unwrap: %d\n", v);
    
    // Test unwrap_or() on success and error
    int !> (CCError) r4 = succeed(200);
    int !> (CCError) r5 = fail_it();
    
    int v4 = r4.unwrap_or(-1);
    int v5 = r5.unwrap_or(-1);
    
    printf("unwrap_or success: %d\n", v4);
    printf("unwrap_or error: %d\n", v5);
    
    if (v4 != 200) {
        printf("ERROR: unwrap_or on success should return value\n");
        return 1;
    }
    if (v5 != -1) {
        printf("ERROR: unwrap_or on error should return default\n");
        return 1;
    }
    
    printf("All result UFCS tests passed!\n");
    return 0;
}
