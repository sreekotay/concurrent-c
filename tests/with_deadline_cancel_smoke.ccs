#include "cc_runtime.cch"
#include "cc_channel.cch"

#include <errno.h>

int main(void) {
    CCChan* ch = cc_chan_create(1);
    if (!ch) return 2;
    (void)cc_chan_init_elem(ch, sizeof(int));

    int v = 0;
    int rc = 0;
    with_deadline(1000) {
        cc_cancel(); /* cancel the current deadline scope */
        if (!cc_is_cancelled()) return 3;
        rc = cc_chan_recv(ch, &v, sizeof(v));
    }
    if (rc != ECANCELED) return 10;

    cc_chan_free(ch);
    return 0;
}

