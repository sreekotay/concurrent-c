{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Concurrent-C",
  "scopeName": "source.concurrent-c",
  "patterns": [
    { "include": "#comments" },
    { "include": "#preprocessor" },
    { "include": "#strings" },
    { "include": "#cc_literals" },
    { "include": "#numbers" },
    { "include": "#ccs_at_keywords" },
    { "include": "#ccs_spawn" },
    { "include": "#ccs_ufcs" },
    { "include": "#cc_keywords" },
    { "include": "#cc_type_sugar" },
    { "include": "#cc_channel_type" },
    { "include": "#keywords" },
    { "include": "#types" },
    { "include": "#constants" },
    { "include": "#function_calls" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        { "name": "comment.line.double-slash.c", "match": "//.*$" },
        {
          "name": "comment.block.c",
          "begin": "/\\*",
          "end": "\\*/"
        }
      ]
    },
    "preprocessor": {
      "patterns": [
        {
          "name": "meta.preprocessor.c",
          "begin": "^(\\s*)(#)\\s*([A-Za-z_][A-Za-z0-9_]*)\\b",
          "beginCaptures": {
            "2": { "name": "keyword.control.directive.c" },
            "3": { "name": "keyword.control.directive.c" }
          },
          "end": "$",
          "patterns": [
            { "include": "#strings" },
            { "include": "#numbers" }
          ]
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.c",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "name": "constant.character.escape.c", "match": "\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8}|[0-7]{1,3}|.)" }
          ]
        },
        {
          "name": "string.quoted.single.c",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "name": "constant.character.escape.c", "match": "\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8}|[0-7]{1,3}|.)" }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.c",
          "match": "\\b(0x[0-9A-Fa-f]([0-9A-Fa-f']*[0-9A-Fa-f])?|\\d([\\d']*\\d)?)(\\.(\\d([\\d']*\\d)?)?)?([eE][+-]?\\d+)?([uUlLfF]{0,3})\\b"
        }
      ]
    },
    "cc_literals": {
      "patterns": [
        {
          "name": "constant.numeric.duration.concurrent-c",
          "match": "\\b\\d+\\s*(ns|us|ms|s|m|h)\\b"
        },
        {
          "name": "keyword.operator.arrow.concurrent-c",
          "match": "=>"
        },
        {
          "name": "keyword.operator.range.concurrent-c",
          "match": "\\.\\."
        }
      ]
    },
    "ccs_at_keywords": {
      "patterns": [
        {
          "name": "keyword.control.concurrent-c",
          "match": "\\B@(async|noblock|latency_sensitive|scoped|nursery|arena|lock|match|defer|for|comptime)\\b"
        },
        {
          "name": "entity.name.label.concurrent-c",
          "match": "(?<=\\B@defer\\s+)[A-Za-z_][A-Za-z0-9_]*(?=\\s*:)"
        },
        {
          "name": "keyword.control.concurrent-c",
          "match": "(?<=\\B@nursery\\s+)closing\\b"
        },
        {
          "name": "keyword.control.concurrent-c",
          "match": "(?<=\\B@for\\s+)await\\b"
        }
      ]
    },
    "ccs_spawn": {
      "patterns": [
        {
          "name": "keyword.control.concurrent-c",
          "match": "\\bspawn\\b"
        }
      ]
    },
    "cc_keywords": {
      "patterns": [
        { "name": "keyword.control.concurrent-c", "match": "\\b(await|try|catch|unsafe|comptime)\\b" },
        { "name": "keyword.control.concurrent-c", "match": "\\bcancel\\b" },
        { "name": "keyword.control.concurrent-c", "match": "\\bwith_deadline\\b" },
        { "name": "keyword.control.concurrent-c", "match": "\\btimeout\\b(?=\\s*\\()" }
      ]
    },
    "cc_type_sugar": {
      "patterns": [
        {
          "name": "meta.type.optional.concurrent-c",
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*)(\\?)(?!\\s*:)",
          "captures": {
            "1": { "name": "entity.name.type.concurrent-c" },
            "2": { "name": "keyword.operator.optional.concurrent-c" }
          }
        },
        {
          "name": "meta.type.result.concurrent-c",
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*)(!)([A-Za-z_][A-Za-z0-9_]*)\\b",
          "captures": {
            "1": { "name": "entity.name.type.concurrent-c" },
            "2": { "name": "keyword.operator.result.concurrent-c" },
            "3": { "name": "entity.name.type.concurrent-c" }
          }
        },
        {
          "name": "meta.type.slice.concurrent-c",
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*)(\\[\\s*:\\s*(!)?\\s*\\])",
          "captures": {
            "1": { "name": "entity.name.type.concurrent-c" },
            "2": { "name": "keyword.operator.slice.concurrent-c" },
            "3": { "name": "keyword.operator.unique.concurrent-c" }
          }
        }
      ]
    },
    "cc_channel_type": {
      "patterns": [
        {
          "name": "meta.type.channel.concurrent-c",
          "begin": "\\[\\s*~",
          "beginCaptures": {
            "0": { "name": "keyword.operator.channel.concurrent-c" }
          },
          "end": "\\]",
          "endCaptures": {
            "0": { "name": "keyword.operator.channel.concurrent-c" }
          },
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            {
              "name": "keyword.control.concurrent-c",
              "match": "\\b(async|sync)\\b"
            },
            {
              "name": "keyword.control.concurrent-c",
              "match": "\\b(Block|Drop|Sample)\\b"
            },
            {
              "name": "meta.type.channel.topology.concurrent-c",
              "match": "\\b(1:1|1:N|N:1|N:N)\\b"
            },
            {
              "name": "keyword.operator.channel.direction.concurrent-c",
              "match": "[<>]"
            },
            {
              "name": "constant.numeric.channel.capacity.concurrent-c",
              "match": "\\b\\d+\\b"
            },
            {
              "name": "keyword.operator.concurrent-c",
              "match": "[:><,()]"
            },
            {
              "name": "constant.language.concurrent-c",
              "match": "\\b(N|1)\\b(?=\\s*[:])"
            }
          ]
        }
      ]
    },
    "ccs_ufcs": {
      "patterns": [
        {
          "name": "meta.function-call.method.concurrent-c",
          "match": "(\\.|->)\\s*([A-Za-z_][A-Za-z0-9_]*)(?=\\s*\\()",
          "captures": {
            "1": { "name": "punctuation.accessor.c" },
            "2": { "name": "entity.name.function.method.c" }
          }
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.c",
          "match": "\\b(break|case|continue|default|do|else|for|goto|if|return|switch|while)\\b"
        },
        {
          "name": "keyword.operator.c",
          "match": "\\b(sizeof|typeof|_Alignof)\\b"
        },
        {
          "name": "keyword.declaration.c",
          "match": "\\b(auto|const|extern|inline|register|restrict|static|typedef|volatile)\\b"
        },
        {
          "name": "keyword.declaration.c",
          "match": "\\b(enum|struct|union)\\b"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "storage.type.c",
          "match": "\\b(void|char|short|int|long|float|double|signed|unsigned|_Bool|_Complex)\\b"
        },
        {
          "name": "storage.type.c",
          "match": "\\b(bool|size_t|ssize_t|intptr_t|uintptr_t|int8_t|int16_t|int32_t|int64_t|uint8_t|uint16_t|uint32_t|uint64_t)\\b"
        },
        {
          "name": "support.type.concurrent-c",
          "match": "\\b(CC[A-Za-z0-9_]+)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        { "name": "constant.language.c", "match": "\\b(NULL|true|false)\\b" },
        { "name": "constant.other.define.c", "match": "\\b[A-Z][A-Z0-9_]{2,}\\b" }
      ]
    },
    "function_calls": {
      "patterns": [
        {
          "name": "meta.function-call.c",
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*)(?=\\s*\\()",
          "captures": {
            "1": { "name": "entity.name.function.c" }
          }
        }
      ]
    }
  }
}


